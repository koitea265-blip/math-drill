<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒãƒƒãƒ—ãƒ»ãƒã‚¹ãƒ»ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼</title>
    <!-- å­ä¾›å‘ã‘ã®å¯æ„›ã„ãƒ•ã‚©ãƒ³ãƒˆã‚’Google Fontsã‹ã‚‰èª­ã¿è¾¼ã¿ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS: ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š --- */
        :root {
            --primary: #4ECDC4; /* ãƒŸãƒ³ãƒˆã‚°ãƒªãƒ¼ãƒ³ */
            --secondary: #FF6B6B; /* ãƒ‘ã‚¹ãƒ†ãƒ«ãƒ¬ãƒƒãƒ‰ */
            --accent: #FFE66D; /* ãƒ‘ã‚¹ãƒ†ãƒ«ã‚¤ã‚¨ãƒ­ãƒ¼ */
            --dark: #292F36;
            --light: #F7FFF7;
            --font-main: 'Mochiy Pop One', sans-serif;
        }

        * {
            box-sizing: border-box;
            touch-action: manipulation; /* ã‚¹ãƒãƒ›ã§ã®ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—æ‹¡å¤§é˜²æ­¢ */
        }

        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-main);
            background-color: var(--accent);
            color: var(--dark);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* ã‚¢ãƒ—ãƒªå…¨ä½“ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        #app-container {
            width: 100%;
            max-width: 500px;
            height: 100%;
            max-height: 900px;
            background-color: var(--light);
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        @media (min-width: 501px) {
            #app-container {
                height: 90vh;
                border-radius: 20px;
                border: 4px solid var(--dark);
            }
        }

        /* ç”»é¢å…±é€šè¨­å®š */
        .screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            transition: opacity 0.3s;
            position: absolute;
            width: 100%;
            height: 100%;
            background: var(--light);
            z-index: 10;
        }

        .hidden {
            display: none !important;
            opacity: 0;
            z-index: 0;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
        h1 {
            font-size: 2.5rem;
            color: var(--secondary);
            text-shadow: 2px 2px 0px var(--dark);
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.2;
        }

        .menu-btn {
            background-color: var(--primary);
            color: white;
            border: 3px solid var(--dark);
            border-radius: 15px;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-family: var(--font-main);
            margin: 10px;
            width: 80%;
            cursor: pointer;
            box-shadow: 4px 4px 0px var(--dark);
            transition: transform 0.1s;
        }

        .menu-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px var(--dark);
        }

        /* ãƒ—ãƒ¬ã‚¤ç”»é¢ */
        .top-bar {
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            font-size: 1.2rem;
            background: var(--primary);
            color: white;
            border-bottom: 3px solid var(--dark);
            position: absolute;
            top: 0;
        }

        .problem-area {
            font-size: 4rem;
            margin: 40px 0 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 120px;
        }

        .answer-box {
            width: 200px;
            height: 80px;
            border: 4px solid var(--dark);
            border-radius: 15px;
            background: white;
            font-size: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        /* ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ */
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
            padding: 10px;
            max-width: 400px;
        }

        .key-btn {
            background-color: white;
            border: 2px solid var(--dark);
            border-radius: 10px;
            padding: 15px;
            font-size: 1.8rem;
            font-family: var(--font-main);
            cursor: pointer;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }

        .key-btn:active {
            background-color: #eee;
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(0,0,0,0.1);
        }

        .key-enter {
            background-color: var(--secondary);
            color: white;
        }
        
        .key-clear {
            background-color: #ccc;
        }

        /* ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        .correct-anim {
            color: var(--primary);
            animation: pop 0.3s ease-out;
        }

        .wrong-anim {
            color: var(--secondary);
            animation: shake 0.4s ease-in-out;
        }

        /* çµæœç”»é¢ */
        .result-score {
            font-size: 5rem;
            color: var(--secondary);
            margin: 20px;
        }
        
        .message {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

    </style>
</head>
<body>

    <div id="app-container">
        <!-- 1. ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
        <div id="start-screen" class="screen">
            <h1>ãƒãƒƒãƒ—ãƒ»ãƒã‚¹<br>ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼</h1>
            <p>ãƒ¬ãƒ™ãƒ«ã‚’ãˆã‚‰ã‚“ã§ã­</p>
            <button class="menu-btn" onclick="startGame('easy')">ã‹ã‚“ãŸã‚“ (ãŸã—ãƒ»ã²ã)</button>
            <button class="menu-btn" onclick="startGame('normal')">ãµã¤ã† (ã‹ã‘ç®—ãƒ»ä¹ä¹)</button>
            <button class="menu-btn" onclick="startGame('hard')">ã‚€ãšã‹ã—ã„ (ã‚ã‚Šç®—ãƒ»ãƒŸãƒƒã‚¯ã‚¹)</button>
        </div>

        <!-- 2. ãƒ—ãƒ¬ã‚¤ç”»é¢ -->
        <div id="game-screen" class="screen hidden">
            <div class="top-bar">
                <span id="timer">æ®‹ã‚Š: 60ç§’</span>
                <span id="score-display">ã‚¹ã‚³ã‚¢: 0</span>
            </div>
            
            <div id="problem-display" class="problem-area">
                <!-- ã“ã“ã«å•é¡ŒãŒè¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>

            <div id="user-answer" class="answer-box">
                <!-- ã“ã“ã«å…¥åŠ›ã—ãŸæ•°å­—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>

            <div class="keypad">
                <button class="key-btn" onclick="inputNum(7)">7</button>
                <button class="key-btn" onclick="inputNum(8)">8</button>
                <button class="key-btn" onclick="inputNum(9)">9</button>
                <button class="key-btn" onclick="inputNum(4)">4</button>
                <button class="key-btn" onclick="inputNum(5)">5</button>
                <button class="key-btn" onclick="inputNum(6)">6</button>
                <button class="key-btn" onclick="inputNum(1)">1</button>
                <button class="key-btn" onclick="inputNum(2)">2</button>
                <button class="key-btn" onclick="inputNum(3)">3</button>
                <button class="key-btn key-clear" onclick="clearInput()">C</button>
                <button class="key-btn" onclick="inputNum(0)">0</button>
                <button class="key-btn key-enter" onclick="checkAnswer()">OK</button>
            </div>
        </div>

        <!-- 3. çµæœç”»é¢ -->
        <div id="result-screen" class="screen hidden">
            <h1>ã—ã‚…ã†ã‚Šã‚‡ã†ï¼</h1>
            <div class="message" id="result-message">ã‚ˆããŒã‚“ã°ã£ãŸã­ï¼</div>
            <div>ã‚ãªãŸã®ã‚¹ã‚³ã‚¢</div>
            <div class="result-score" id="final-score">0</div>
            <button class="menu-btn" onclick="goHome()">ã‚‚ã†ã„ã¡ã© ã‚ãã¶</button>
        </div>
    </div>

    <script>
        /* --- JavaScript: ã‚¢ãƒ—ãƒªã®ãƒ­ã‚¸ãƒƒã‚¯ --- */
        
        let currentLevel = 'easy';
        let score = 0;
        let timeLeft = 60;
        let timerInterval;
        let currentAnswer = 0;
        let inputString = "";

        // ç”»é¢è¦ç´ ã®å–å¾—
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultScreen = document.getElementById('result-screen');
        const problemDisplay = document.getElementById('problem-display');
        const answerDisplay = document.getElementById('user-answer');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score-display');
        const finalScoreDisplay = document.getElementById('final-score');
        const resultMessage = document.getElementById('result-message');

        // ã‚²ãƒ¼ãƒ é–‹å§‹å‡¦ç†
        function startGame(level) {
            currentLevel = level;
            score = 0;
            timeLeft = 60;
            inputString = "";
            
            scoreDisplay.textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
            timerDisplay.textContent = `æ®‹ã‚Š: ${timeLeft}ç§’`;
            
            // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
            startScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');

            generateProblem();
            
            // ã‚¿ã‚¤ãƒãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆ
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = `æ®‹ã‚Š: ${timeLeft}ç§’`;
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        // å•é¡Œä½œæˆãƒ­ã‚¸ãƒƒã‚¯
        function generateProblem() {
            let num1, num2, operator, symbol;

            // ãƒ¬ãƒ™ãƒ«ã”ã¨ã®å•é¡Œç”Ÿæˆãƒ«ãƒ¼ãƒ«
            if (currentLevel === 'easy') {
                // è¶³ã—ç®—ãƒ»å¼•ãç®— (ç­”ãˆãŒ20ä»¥ä¸‹)
                operator = Math.random() > 0.5 ? '+' : '-';
                if (operator === '+') {
                    num1 = Math.floor(Math.random() * 10) + 1;
                    num2 = Math.floor(Math.random() * 10) + 1;
                    currentAnswer = num1 + num2;
                } else {
                    num1 = Math.floor(Math.random() * 10) + 5; // å¼•ã‹ã‚Œã‚‹æ•°ã‚’å¤§ãã‚ã«
                    num2 = Math.floor(Math.random() * (num1 - 1)) + 1; // ç­”ãˆãŒè² ã«ãªã‚‰ãªã„ã‚ˆã†ã«
                    currentAnswer = num1 - num2;
                }
                symbol = operator;
            } else if (currentLevel === 'normal') {
                // ä¹ä¹ (æ›ã‘ç®—ã®ã¿)
                operator = '*';
                num1 = Math.floor(Math.random() * 9) + 1;
                num2 = Math.floor(Math.random() * 9) + 1;
                currentAnswer = num1 * num2;
                symbol = 'Ã—';
            } else {
                // é›£ã—ã„ (å‰²ã‚Šç®—å«ã‚€ãƒŸãƒƒã‚¯ã‚¹)
                const types = ['+', '-', '*', '/'];
                operator = types[Math.floor(Math.random() * types.length)];
                
                if (operator === '+') {
                    num1 = Math.floor(Math.random() * 50) + 10;
                    num2 = Math.floor(Math.random() * 50) + 10;
                    currentAnswer = num1 + num2;
                    symbol = '+';
                } else if (operator === '-') {
                    num1 = Math.floor(Math.random() * 50) + 50;
                    num2 = Math.floor(Math.random() * 40) + 10;
                    currentAnswer = num1 - num2;
                    symbol = '-';
                } else if (operator === '*') {
                    num1 = Math.floor(Math.random() * 12) + 2;
                    num2 = Math.floor(Math.random() * 9) + 1;
                    currentAnswer = num1 * num2;
                    symbol = 'Ã—';
                } else { // å‰²ã‚Šç®—
                    // å‰²ã‚Šåˆ‡ã‚Œã‚‹æ•°ã‚’ä½œã‚‹ãŸã‚ã«é€†ç®—ã™ã‚‹
                    // ç­”ãˆ(2~9) * å‰²ã‚‹æ•°(2~9) = å‰²ã‚‰ã‚Œã‚‹æ•°
                    let ans = Math.floor(Math.random() * 9) + 2;
                    num2 = Math.floor(Math.random() * 9) + 2;
                    num1 = ans * num2;
                    currentAnswer = ans;
                    symbol = 'Ã·';
                }
            }

            // HTMLæ•°å¼è¡¨ç¤º (LaTeXé¢¨ã«è¦‹ã‚„ã™ã)
            problemDisplay.innerHTML = `${num1} <span style="color:var(--secondary); margin:0 10px;">${symbol}</span> ${num2} = ?`;
            inputString = "";
            updateAnswerDisplay();
        }

        // ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰å…¥åŠ›å‡¦ç†
        function inputNum(num) {
            if (inputString.length < 4) { // æ¡æ•°åˆ¶é™
                inputString += num;
                updateAnswerDisplay();
            }
        }

        function clearInput() {
            inputString = "";
            updateAnswerDisplay();
        }

        function updateAnswerDisplay() {
            answerDisplay.textContent = inputString;
        }

        // ç­”ãˆåˆã‚ã›
        function checkAnswer() {
            if (inputString === "") return;
            
            const userVal = parseInt(inputString);
            
            if (userVal === currentAnswer) {
                // æ­£è§£ï¼
                score += 10; // åŸºæœ¬ç‚¹
                // æ®‹ã‚Šæ™‚é–“ãƒœãƒ¼ãƒŠã‚¹ã‚’å…¥ã‚Œã‚‹ãªã‚‰ã“ã“
                scoreDisplay.textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
                
                // æ­£è§£ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                problemDisplay.classList.remove('wrong-anim');
                answerDisplay.style.borderColor = "var(--primary)";
                answerDisplay.style.color = "var(--primary)";
                
                setTimeout(() => {
                    answerDisplay.style.borderColor = "var(--dark)";
                    answerDisplay.style.color = "var(--dark)";
                    generateProblem();
                }, 300);

            } else {
                // ä¸æ­£è§£
                answerDisplay.classList.add('wrong-anim');
                answerDisplay.style.borderColor = "var(--secondary)";
                
                setTimeout(() => {
                    answerDisplay.classList.remove('wrong-anim');
                    answerDisplay.style.borderColor = "var(--dark)";
                    clearInput();
                }, 500);
            }
        }

        // ã‚²ãƒ¼ãƒ çµ‚äº†å‡¦ç†
        function endGame() {
            clearInterval(timerInterval);
            gameScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            finalScoreDisplay.textContent = score;

            // ã‚¹ã‚³ã‚¢ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            if (score >= 200) {
                resultMessage.textContent = "ã™ã”ã„ï¼å¤©æ‰ã ã­ï¼ğŸ†";
            } else if (score >= 100) {
                resultMessage.textContent = "ã¨ã£ã¦ã‚‚ã„ã„æ„Ÿã˜ï¼âœ¨";
            } else {
                resultMessage.textContent = "ã¤ãã¯ã‚‚ã£ã¨ã„ã‘ã‚‹ã‚ˆï¼ğŸ’ª";
            }
        }

        function goHome() {
            resultScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
        }

    </script>
</body>
</html>